{% extends "base.html" %}

{% block title %}Login - Data Science Assistant{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <i class="fas fa-robot auth-icon"></i>
            <h2>Welcome Back</h2>
            <p>Sign in to your Data Science Assistant account</p>
        </div>
        
        <form id="loginForm" class="auth-form">
            <div class="form-group">
                <div class="input-group">
                    <i class="fas fa-envelope input-icon"></i>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        placeholder="Email address" 
                        required 
                        autocomplete="email"
                    >
                </div>
            </div>
            
            <div class="form-group">
                <div class="input-group">
                    <i class="fas fa-lock input-icon"></i>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        placeholder="Password" 
                        required 
                        autocomplete="current-password"
                    >
                </div>
            </div>
            
            <div class="form-group">
                <label class="checkbox-container">
                    <input type="checkbox" id="rememberMe">
                    <span class="checkmark"></span>
                    Remember me
                </label>
            </div>
            
            <button type="submit" class="btn btn-primary btn-full">
                <span class="btn-text">Sign In</span>
                <i class="fas fa-spinner fa-spin btn-spinner" style="display: none;"></i>
            </button>
        </form>
        
        <div class="auth-footer">
            <p>Don't have an account? <a href="/register" class="auth-link">Sign up here</a></p>
            <p><a href="/forgot-password" class="auth-link">Forgot your password?</a></p>
        </div>
        
        <div class="demo-section">
            <hr class="divider">
            <p class="demo-text">Want to try it first?</p>
            <button id="demoBtn" class="btn btn-outline">
                <i class="fas fa-play"></i> Try Demo
            </button>
        </div>
    </div>
</div>

<div id="errorModal" class="modal" style="display: none;">
    <div class="modal-content error-modal">
        <div class="modal-header">
            <i class="fas fa-exclamation-triangle error-icon"></i>
            <h3>Login Error</h3>
        </div>
        <div class="modal-body">
            <p id="errorMessage"></p>
        </div>
        <div class="modal-footer">
            <button onclick="closeErrorModal()" class="btn btn-primary">OK</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/auth.js') }}"></script>
<script>
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const btn = document.querySelector('.btn-primary');
    const btnText = document.querySelector('.btn-text');
    const btnSpinner = document.querySelector('.btn-spinner');
    
    // Show loading state
    btnText.style.display = 'none';
    btnSpinner.style.display = 'inline-block';
    btn.disabled = true;
    
    const formData = {
        email: document.getElementById('email').value,
        password: document.getElementById('password').value
    };
    
    try {
        const response = await fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Store API key
            localStorage.setItem('apiKey', data.api_key);
            localStorage.setItem('userPlan', data.plan);
            
            // Redirect to main app
            window.location.href = '/';
        } else {
            showError(data.error || 'Login failed');
        }
    } catch (error) {
        showError('Network error. Please try again.');
    } finally {
        // Reset button state
        btnText.style.display = 'inline-block';
        btnSpinner.style.display = 'none';
        btn.disabled = false;
    }
});

// Demo button functionality
document.getElementById('demoBtn').addEventListener('click', function() {
    // Create demo user session
    localStorage.setItem('demoMode', 'true');
    window.location.href = '/demo';
});

function showError(message) {
    document.getElementById('errorMessage').textContent = message;
    document.getElementById('errorModal').style.display = 'flex';
}

function closeErrorModal() {
    document.getElementById('errorModal').style.display = 'none';
}
</script>
{% endblock %}