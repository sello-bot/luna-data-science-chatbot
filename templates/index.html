<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Science Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-robot"></i> DS Assistant<br><h3> Luna </h3></h2>
            </div>
            
            <div class="sidebar-section">
                <h3>Quick Actions</h3>
                <div class="quick-actions">
                    <button class="btn-action" onclick="sendQuickMessage('help')">
                        <i class="fas fa-question-circle"></i> Help
                    </button>
                    <button class="btn-action" onclick="sendQuickMessage('show available datasets')">
                        <i class="fas fa-database"></i> Datasets
                    </button>
                    <button class="btn-action" onclick="sendQuickMessage('create sample data')">
                        <i class="fas fa-plus"></i> Sample Data
                    </button>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3>Upload Data</h3>
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="fileInput" accept=".csv,.json,.xlsx,.xls" style="display: none;">
                    <div class="upload-content" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload or drag & drop</p>
                        <small>CSV, JSON, Excel files</small>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3>Recent Plots</h3>
                <div id="recentPlots" class="recent-plots">
                    <!-- Recent plots will be populated here -->
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3>Dataset Info</h3>
                <div id="datasetInfo" class="dataset-info">
                    <p class="no-data">No dataset loaded</p>
                </div>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="main-content">
            <div class="chat-header">
                <h1>Data Science Assistant</h1>
                <p>Ask me anything about data analysis, machine learning, and visualizations!</p>
            </div>
            
            <div class="chat-container" id="chatContainer">
                <div class="message bot-message">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <p>Hello! I'm your data science assistant. I can help you with:</p>
                        <ul>
                            <li>Loading and analyzing datasets</li>
                            <li>Creating visualizations</li>
                            <li>Training machine learning models</li>
                            <li>Data cleaning and preprocessing</li>
                            <li>Statistical analysis</li>
                        </ul>
                        <p>Try uploading a dataset or type 'help' to get started!</p>
                    </div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input type="text" id="messageInput" placeholder="Type your message here..." autocomplete="off">
                    <button id="sendButton" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="input-suggestions" id="inputSuggestions">
                    <button class="suggestion-btn" onclick="sendQuickMessage('load data sample.csv')">Load Sample Data</button>
                    <button class="suggestion-btn" onclick="sendQuickMessage('show data summary')">Show Summary</button>
                    <button class="suggestion-btn" onclick="sendQuickMessage('create visualization')">Create Plot</button>
                    <button class="suggestion-btn" onclick="sendQuickMessage('train a model')">Train Model</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <i class="fas fa-cog fa-spin"></i>
            <p>Processing your request...</p>
        </div>
    </div>
    
    <!-- Code modal -->
    <div id="codeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Generated Code</h3>
                <span class="close" onclick="closeModal('codeModal')">&times;</span>
            </div>
            <div class="modal-body">
                <pre id="codeContent"></pre>
                <button class="btn-copy" onclick="copyCode()">
                    <i class="fas fa-copy"></i> Copy Code
                </button>
            </div>
        </div>
    </div>
    
    <!-- Data modal -->
    <div id="dataModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Data View</h3>
                <span class="close" onclick="closeModal('dataModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="dataContent"></div>
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeChat();
            setupFileUpload();
            setupKeyboardShortcuts();
        });
        
        // Handle Enter key in input
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // File upload functionality
        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            
            fileInput.addEventListener('change', handleFileUpload);
            
            // Drag and drop functionality
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload({target: {files: files}});
                }
            });
        }
        
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + Enter to send message
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    sendMessage();
                }
                
                // Escape to close modals
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
        }
        
        function closeAllModals() {
            document.getElementById('codeModal').style.display = 'none';
            document.getElementById('dataModal').style.display = 'none';
        }
    </script>
</body>
</html>